# Transportation Analysis System

## ๐ ะะฑะทะพั ัะธััะตะผั

**Transportation Analysis System** - ััะพ ะบะพะผะฟะปะตะบัะฝะฐั ัะธััะตะผะฐ ะฐะฝะฐะปะธะทะฐ ะณะพัะพะดัะบะพะณะพ ััะฐะฝัะฟะพััะฐ, ะพะฑัะตะดะธะฝัััะฐั ะผะพะฝะธัะพัะธะฝะณ ัะฐัะฟัะตะดะตะปะตะฝะธั ะฟะฐััะฐะถะธัะพะฒ ะฒ ะฐะฒัะพะฑััะฐั ะธ ะธะฝัะตะปะปะตะบััะฐะปัะฝัั ะพะฑัะฐะฑะพัะบั ะดะฐะฝะฝัั ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะผะธะบัะพัะตัะฒะธัะฝะพะน ะฐััะธัะตะบัััั.

### ๐ฏ ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

- **๐ก ะะพะฝะธัะพัะธะฝะณ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ** - ัะฑะพั ะธ ะฐะฝะฐะปะธะท WiFi ัะธะณะฝะฐะปะพะฒ ะดะปั ะพะฟัะตะดะตะปะตะฝะธั ัะฐัะฟัะตะดะตะปะตะฝะธั ะฟะฐััะฐะถะธัะพะฒ
- **๐ค ะะฝัะตะปะปะตะบััะฐะปัะฝัะน ะฐะฝะฐะปะธะท** - ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะทัะบะพะฒัั ะผะพะดะตะปะตะน ะดะปั ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั
- **๐ฅ ะะฝะฐะปะธะท ัะพะปะฟั** - ะพัะตะฝะบะฐ ะทะฐะฟะพะปะฝะตะฝะฝะพััะธ ะธ ัะฐัะฟัะตะดะตะปะตะฝะธั ะปัะดะตะน ะฒ ััะฐะฝัะฟะพััะต
- **๐ ะะธะทัะฐะปะธะทะฐัะธั ะดะฐะฝะฝัั** - ะณัะฐัะธะบะธ, ััะตะผั ะธ ะฐะฝะฐะปะธัะธัะตัะบะธะต ะพััะตัั
- **๐พ ะญะบัะฟะพัั ะดะฐะฝะฝัั** - ัะพััะฐะฝะตะฝะธะต ัะตะทัะปััะฐัะพะฒ ะฒ ัะฐะทะปะธัะฝัั ัะพัะผะฐัะฐั

## ๐๏ธ ะััะธัะตะบัััะฐ ัะธััะตะผั

ะัะพะตะบั ัะพััะพะธั ะธะท ััะตั ะพัะฝะพะฒะฝัั ัะตัะฒะธัะพะฒ:

### ๐ง ะัะฝะพะฒะฝัะต ัะตัะฒะธัั

- **๐ LLM Service** (ะฟะพัั 1337) - ัะตัะฒะธั ะดะปั ัะฐะฑะพัั ั ัะทัะบะพะฒัะผะธ ะผะพะดะตะปัะผะธ
- **๐ Crowd Analysis Service** (ะฟะพัั 1338) - ัะตัะฒะธั ะฐะฝะฐะปะธะทะฐ ัะพะปะฟั
- **๐ก Bus Signal Analyzer** - ัะธััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ ัะฐัะฟัะตะดะตะปะตะฝะธั ะฒ ะฐะฒัะพะฑััะฐั

### ะะฑัะฐั ะฐััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    Serial/USB    โโโโโโโโโโโโโโโโโโโโ    HTTP/REST    โโโโโโโโโโโโโโโโโโโโ
โ   ESP32 Module  โโโโโโโโโโโโโโโโโโโบโ   Python Analyzerโโโโโโโโโโโโโโโโโโบโ  Microservices   โ
โ                 โ                  โ                  โ                 โ                  โ
โ  - WiFi Scanner โ                  โ  - Data Processorโ                 โ  - LLM Service   โ
โ  - RSSI Collectorโ                 โ  - Visualization โ                 โ  - Crowd Analysisโ
โโโโโโโโโโโโโโโโโโโ                  โ  - CSV Export    โ                 โโโโโโโโโโโโโโโโโโโโ
                                     โโโโโโโโโโโโโโโโโโโโ
                                              โ
                                     โโโโโโโโโโผโโโโโโโโโ
                                     โ   Results       โ
                                     โ   Directory     โ
                                     โโโโโโโโโโโโโโโโโโโ
```

## ๐ ะัััััะน ััะฐัั

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั
```bash
git clone <repository-url>
cd template
```

### 2. ะะฐะฟััะบ ั Docker Compose
```bash
# ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ
docker-compose up --build -d
```

```bash
# ะัะพัะผะพัั ะปะพะณะพะฒ
docker-compose logs -f
```

```bash
# ะััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะพะฒ
docker-compose down
```

### 3. ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

ะ docker compose ะฝะตะพะฑัะพะดะธะผะพ ัะบะฐะทะฐัั ัััะปะบั ะฝะฐ ะฟัะพะฒะฐะนะดะตัะฐ ะธ ะบะปัั API:

```yaml
environment:
  - OPENAI_API_KEY=${OPENAI_API_KEY:-<YOUR KEY HERE>}
  - OPENAI_BASE_URL=${OPENAI_BASE_URL:-<OPENROUTER || PROXYAPI>}
```

### 4. ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

ะะพัะปะต ะทะฐะฟััะบะฐ ะพัะบัะพะนัะต [prototype.html](./prototype.html) ะดะปั ัะตััะธัะพะฒะฐะฝะธั ััะฝะบัะธะพะฝะฐะปะฐ. ะัะธะผะตัั ะดะฐะฝะฝัั ะฝะฐัะพะดัััั ะฒ ะฟะฐะฟะบะต [data](./data/).

## ๐ก Bus Signal Distribution Analyzer

### ะขะตัะฝะพะปะพะณะธั ัะฐะฑะพัั

#### ๐ก ะกะฑะพั ะดะฐะฝะฝัั (ESP32)
ESP32 ัะฐะฑะพัะฐะตั ะบะฐะบ WiFi ัะบะฐะฝะตั:
- ะกะบะฐะฝะธััะตั ะพะบััะถะฐััะธะต WiFi ััััะพะนััะฒะฐ
- ะะทะผะตััะตั RSSI (ัะธะปั ัะธะณะฝะฐะปะฐ) ะดะปั ะบะฐะถะดะพะณะพ ะพะฑะฝะฐััะถะตะฝะฝะพะณะพ ััััะพะนััะฒะฐ
- ะัะฟัะฐะฒะปัะตั ะดะฐะฝะฝัะต ะฒ ัะพัะผะฐัะต: `timestamp,rssi` ะธะปะธ `rssi`
- RSSI ะทะฝะฐัะตะฝะธั ะฒะฐััะธัััััั ะพั -30 dBm (ะฑะปะธะทะบะพ) ะดะพ -100 dBm (ะดะฐะปะตะบะพ)

#### ๐ฏ ะะปะณะพัะธัะผ ะฐะฝะฐะปะธะทะฐ ัะฐัะฟัะตะดะตะปะตะฝะธั

**ะะปะฐััะธัะธะบะฐัะธั ะทะพะฝ ะฐะฒัะพะฑััะฐ:**
```python
location_thresholds = {
    'back': -50,    # ะะฐะดะฝัั ัะฐััั - ัะธะปัะฝัะต ัะธะณะฝะฐะปั
    'middle': -65,  # ะกัะตะดะฝัั ัะฐััั - ััะตะดะฝะธะต ัะธะณะฝะฐะปั  
    'front': -85    # ะะตัะตะดะฝัั ัะฐััั - ัะปะฐะฑัะต ัะธะณะฝะฐะปั
}
```

**ะะพะณะธะบะฐ ะพะฟัะตะดะตะปะตะฝะธั ะผะตััะพะฟะพะปะพะถะตะฝะธั:**
```python
def get_location(rssi):
    if rssi > -50:    return 2, 'Back'    # ะะปะธะทะบะพ ะบ ะฟัะธะตะผะฝะธะบั
    elif rssi > -65:  return 1, 'Middle'  # ะกัะตะดะฝะตะต ัะฐัััะพัะฝะธะต
    elif rssi > -85:  return 0, 'Front'   # ะะฐะปะตะบะพ ะพั ะฟัะธะตะผะฝะธะบะฐ
    else:             return -1, 'Noise'  # ะกะปะธัะบะพะผ ัะปะฐะฑัะน ัะธะณะฝะฐะป
```

### โ๏ธ ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ ะฐะฝะฐะปะธะทะฐัะพัะฐ

#### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั:
- Python 3.8 ะธะปะธ ะฝะพะฒะตะต
- pip (ะผะตะฝะตะดะถะตั ะฟะฐะบะตัะพะฒ Python)
- ะะพัััะฟ ะบ ะฟะพััั USB ะดะปั ะฟะพะดะบะปััะตะฝะธั ESP32

#### ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน:
```bash
pip install pandas numpy matplotlib pyserial
```

#### ะะฐะฟััะบ ัะธััะตะผั:
```bash
python bus_analyzer.py
```

### ๐ ะคะพัะผะฐั ะดะฐะฝะฝัั ESP32

**ะัะฝะพะฒะฝะพะน ัะพัะผะฐั:**
```
timestamp,rssi
```
**ะัะธะผะตั:**
```
123456789,-65
123456790,-72
123456791,-58
```

**ะฃะฟัะพัะตะฝะฝัะน ัะพัะผะฐั:**
```
rssi
```
**ะัะธะผะตั:**
```
-65
-72
-58
```

## ๐ API Endpoints

ะะพัะปะต ะทะฐะฟััะบะฐ ัะตัะฒะธัั ะฑัะดัั ะดะพัััะฟะฝั ะฟะพ ัะปะตะดัััะธะผ ะฐะดัะตัะฐะผ:

- **๐ฎ LLM Service**: http://localhost:1337
- **๐ฅ Crowd Analysis Service**: http://localhost:1338

## ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ

### ะะตัะตัะฑะพัะบะฐ ะพะฑัะฐะทะพะฒ

```bash
# ะะตัะตัะฑะพัะบะฐ ะฒัะตั ะพะฑัะฐะทะพะฒ
docker-compose build

# ะะตัะตัะฑะพัะบะฐ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ
docker-compose build llm-service
```

### ะัะพัะผะพัั ัะพััะพัะฝะธั

```bash
# ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose ps

# ะะพะณะธ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ
docker-compose logs llm-service

# ะะพะดะบะปััะตะฝะธะต ะบ ะบะพะฝัะตะนะฝะตัั
docker-compose exec llm-service sh
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
template/
โโโ docker-compose.yaml          # ะะพะฝัะธะณััะฐัะธั Docker Compose
โโโ data/                        # ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั ะดะฐะฝะฝัั
โโโ src/services/
โ   โโโ llm_service/            # ๐ฎ LLM ัะตัะฒะธั
โ   โโโ crowd_analysis_service/ # ๐ฅ ะกะตัะฒะธั ะฐะฝะฐะปะธะทะฐ ัะพะปะฟั
โ   โโโ bus_analyzer/           # ๐ก ะะฝะฐะปะธะทะฐัะพั ะฐะฒัะพะฑััะฝัั ัะธะณะฝะฐะปะพะฒ
โโโ prototype.html              # ๐ฏ ะะตะฑ-ะธะฝัะตััะตะนั
โโโ README.md                   # ๐ ะะพะบัะผะตะฝัะฐัะธั
```

## ๐งฎ ะะปะณะพัะธัะผ ะฐะฝะฐะปะธะทะฐ ัะธะณะฝะฐะปะพะฒ

### 1. ะัะตะดะพะฑัะฐะฑะพัะบะฐ ะดะฐะฝะฝัั
```python
def filter_short_stops(df, min_stop_duration=1):
    # ะคะธะปััััะตั ะบะพัะพัะบะธะต ะพััะฐะฝะพะฒะบะธ (< 1 ะผะธะฝััั)
    # ะะณะฝะพัะธััะตั ะดะฐะฝะฝัะต ั ะดะฒะธะถััะตะณะพัั ะฐะฒัะพะฑััะฐ
```

### 2. ะะปะฐััะธัะธะบะฐัะธั ัะธะณะฝะฐะปะพะฒ
- **๐ด Back (ะะฐะดะฝัั)**: RSSI > -50 dBm
- **๐ก Middle (ะกัะตะดะฝัั)**: -65 โค RSSI < -50 dBm  
- **๐ข Front (ะะตัะตะดะฝัั)**: -85 โค RSSI < -65 dBm
- **โซ Noise (ะจัะผ)**: RSSI < -85 dBm

### 3. ะกัะฐัะธััะธัะตัะบะธะน ะฐะฝะฐะปะธะท
```python
def generate_summary(df, cycle_count):
    # ะะฐััะตั ะฟัะพัะตะฝัะพะฒ ัะฐัะฟัะตะดะตะปะตะฝะธั ะฟะพ ะทะพะฝะฐะผ
    # ะะฟัะตะดะตะปะตะฝะธะต ะฟัะตะพะฑะปะฐะดะฐััะตะน ะทะพะฝั
    # ะะตะฝะตัะฐัะธั ัะตะบััะพะฒะพะณะพ ะพััะตัะฐ
```

## ๐ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะขะธะฟะธัะฝัะน ัะฐะฑะพัะธะน ัะธะบะป:
```
ะฆะธะบะป ะฐะฝะฐะปะธะทะฐ #1
==================================================
ะะพะดะบะปััะตะฝะพ ะบ /dev/ttyUSB0
ะะฐัะฐั ัะฑะพั ะดะฐะฝะฝัั ะฝะฐ 2 ะผะธะฝัั...
ะกะฑะพั ะดะฐะฝะฝัั ะทะฐะฒะตััะตะฝ. ะกะพะฑัะฐะฝะพ 847 ะธะทะผะตัะตะฝะธะน

ะะะะะะ ะะะกะะะะะะะะะะฏ ะกะะะะะะะ ะ ะะะขะะะฃะกะ
============================================
ะะตัะธะพะด ะฐะฝะฐะปะธะทะฐ: 2.0 ะผะธะฝัั
ะัะตะณะพ ะธะทะผะตัะตะฝะธะน RSSI: 723
ะกัะตะดะฝะธะน RSSI: -68.5 dBm

--- ะะะกะะะะะะะะะะ ะกะะะะะะะ ะะ ะะะะะ ---
Front:    110 ะธะทะผะตัะตะฝะธะน (15.2%) ๐ข
Middle:   331 ะธะทะผะตัะตะฝะธะน (45.8%) ๐ก  
Back:     282 ะธะทะผะตัะตะฝะธะน (39.0%) ๐ด

ะะะะะะะะะะฎะฉะะ ะกะะะะะ: ะกะะะจะะะะะ
```

## ๐ Troubleshooting

### ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะตัะฒะธัะพะฒ
```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
docker-compose ps

# ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ
docker-compose logs

# ะะตัะตะทะฐะฟััะบ ัะตัะฒะธัะฐ
docker-compose restart llm-service
```

### ะะฐัะฟัะพัััะฐะฝะตะฝะฝัะต ะฟัะพะฑะปะตะผั:

**ะะตั ะฟะพะดะบะปััะตะฝะธั ะบ ESP32:**
```
ะัะธะฑะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ /dev/ttyUSB0: [Errno 2] No such file or directory
```
**ะะตัะตะฝะธะต**: ะัะพะฒะตัััะต ัะธะทะธัะตัะบะพะต ะฟะพะดะบะปััะตะฝะธะต ะธ ะฟัะฐะฒะฐ ะดะพัััะฟะฐ ะบ ะฟะพััั

**ะะตั ะดะฐะฝะฝัั ะพั ESP32:**
```
ะะฐะฝะฝัะต ะฝะต ะฟะพะปััะตะฝั. ะัะพะฟััะบะฐะตะผ ัะธะบะป.
```
**ะะตัะตะฝะธะต**: ะัะพะฒะตัััะต ัะพัะผะฐั ะดะฐะฝะฝัั ะธ ัะบะพัะพััั ะฟะตัะตะดะฐัะธ (baudrate=115200)

### ะัะธััะบะฐ
```bash
# ะััะฐะฝะพะฒะบะฐ ะธ ัะดะฐะปะตะฝะธะต ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose down

# ะฃะดะฐะปะตะฝะธะต ั ะพัะธััะบะพะน volumes
docker-compose down -v

# ะฃะดะฐะปะตะฝะธะต ะพะฑัะฐะทะพะฒ
docker-compose down --rmi all
```

## ๐ ะะตะทัะปััะฐัั ะธ ะฒะธะทัะฐะปะธะทะฐัะธั

ะกะธััะตะผะฐ ะณะตะฝะตัะธััะตั comprehensive ะพััะตัั ะธ ะฒะธะทัะฐะปะธะทะฐัะธะธ:

- **๐ ะัะฐัะธะบะธ ัะฐัะฟัะตะดะตะปะตะฝะธั** RSSI ัะธะณะฝะฐะปะพะฒ ั ะฟะพัะพะณะฐะผะธ ะทะพะฝ
- **๐ ะกัะตะผั ะฐะฒัะพะฑััะฐ** ั ะฒะธะทัะฐะปะธะทะฐัะธะตะน ะทะฐะฟะพะปะฝะตะฝะฝะพััะธ ะทะพะฝ
- **๐ ะะธะฝะฐะผะธะบะฐ ััััะพะนััะฒ** ะฒ ะผะธะฝััั
- **๐ ะขะตะบััะพะฒัะต ะพััะตัั** ั ะดะตัะฐะปัะฝะพะน ััะฐัะธััะธะบะพะน

### ะัะธะผะตั ะฒะธะทัะฐะปะธะทะฐัะธะธ:
![ะะฐัะฟัะตะดะตะปะตะฝะธะต ะปัะดะตะน ะฒ ะฐะฒัะพะฑััะต](people_in_the_bus.png)

### ะกัะตะผะฐ ะฐะฒัะพะฑััะฐ:
![ะกัะตะผะฐ ะฐะฒัะพะฑััะฐ](photo_2025-10-05_11-02-48.jpg)

## ๐ฎ ะะฐะปัะฝะตะนัะตะต ัะฐะทะฒะธัะธะต

### ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั:
- **๐ง ะะฐัะธะฝะฝะพะต ะพะฑััะตะฝะธะต** ะดะปั ะฑะพะปะตะต ัะพัะฝะพะน ะบะปะฐััะธัะธะบะฐัะธะธ
- **๐ ะะตะฑ-ะธะฝัะตััะตะนั** ะดะปั ัะดะฐะปะตะฝะฝะพะณะพ ะผะพะฝะธัะพัะธะฝะณะฐ
- **๐ฑ ะะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต** ะดะปั ะพะฟะตัะฐัะธะฒะฝะพะณะพ ะฟัะพัะผะพััะฐ
- **๐ฏ ะะฝัะตะณัะฐัะธั ั GPS** ะดะปั ะฟัะธะฒัะทะบะธ ะบ ะพััะฐะฝะพะฒะบะฐะผ
- **๐ข ะัะปััะธ-ESP32 ัะธััะตะผะฐ** ะดะปั ะฟะพะฒััะตะฝะธั ัะพัะฝะพััะธ

---

## ๐ ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!

ะะปั ะฝะฐัะฐะปะฐ ัะฐะฑะพัั:
1. ะะฐะฟัััะธัะต ะผะธะบัะพัะตัะฒะธัั: `docker-compose up --build -d`
2. ะะพะดะบะปััะธัะต ESP32 ะธ ะทะฐะฟัััะธัะต ะฐะฝะฐะปะธะทะฐัะพั: `python pars_vis.py`
3. ะัะบัะพะนัะต ะฒะตะฑ-ะธะฝัะตััะตะนั: `prototype.html`

ะะฐัะปะฐะถะดะฐะนัะตัั ะบะพะผะฟะปะตะบัะฝัะผ ะฐะฝะฐะปะธะทะพะผ ะณะพัะพะดัะบะพะณะพ ััะฐะฝัะฟะพััะฐ! ๐